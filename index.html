<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>공성 관리 도구</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- 로그인 오버레이 -->
  <div id="login-overlay" class="login-overlay">
    <div class="login-card">
      <h2>공성 관리 도구</h2>
      <p class="login-desc">접속을 위해 비밀번호를 입력해주세요.</p>
      <form id="login-form">
        <input
          type="password"
          id="login-password"
          placeholder="비밀번호 (토트넘 / 류징징)"
          autocomplete="current-password"
        />
        <button type="submit">입장</button>
      </form>
      <p id="login-error" class="login-error"></p>
      <p class="login-hint">
        * 토트넘(길드원) / 류징징(관리자) 중 하나를 입력하세요.<br />
        * 길드 내에서만 공유되는 비밀번호입니다.
      </p>
    </div>
  </div>

  <div class="container">
    <h1>공성 관리 도구</h1>

    <!-- 활동 중 멤버 + 주간 요약 -->
    <section id="summary" class="card">
      <div class="card-header">
        <h2>주간 요약</h2>
        <div class="week-controls">
          <button type="button" id="prev-week-btn">◀ 이전 주</button>
          <span id="week-label">2025년 11월 17일 (월) 3주차</span>
          <button type="button" id="next-week-btn">다음 주 ▶</button>
          <button type="button" id="this-week-btn">이번 주</button>
        </div>
      </div>
      <div class="summary-content">
        <div class="summary-box">
          <div class="summary-title">이번 주 활동 인원</div>
          <div class="summary-value"><span id="active-count">0</span>명</div>
        </div>
        <div class="summary-box">
          <div class="summary-title">총 공성 점수</div>
          <div class="summary-value"><span id="total-score">0</span></div>
        </div>
        <div class="summary-box">
          <div class="summary-title">평균 점수</div>
          <div class="summary-value"><span id="avg-score">0</span></div>
        </div>
        <div class="summary-box">
          <div class="summary-title">방어덱 참여</div>
          <div class="summary-value"><span id="defense-count">0</span>명</div>
        </div>
      </div>
    </section>

    <!-- 활동 중 멤버 표 -->
    <section id="active-members" class="card">
      <div class="card-header">
        <h2>활동 중 멤버 (요일별 점수)</h2>
        <div class="controls-row">
          <div class="mode-badge">
            <span id="mode-label">권한: 미로그인</span>
          </div>
          <div class="threshold-controls admin-only">
            <label>컷 기준:
              <input type="number" id="threshold-input" min="0" step="100000" />
            </label>
            <button type="button" id="threshold-apply-btn">적용</button>
            <span id="threshold-label"></span>
          </div>
          <div class="sort-controls">
            <button type="button" class="sort-btn" data-sort-key="name">
              닉네임 정렬
            </button>
            <button type="button" class="sort-btn" data-sort-key="total">
              총점 정렬
            </button>
            <button type="button" class="sort-btn" data-sort-key="defense">
              방덱 참여 우선
            </button>
          </div>
        </div>
      </div>
      <div class="table-wrapper">
        <table class="members-table">
          <thead>
            <tr>
              <th>#</th>
              <th>닉네임</th>
              <th>직책</th>
              <th>가입일</th>
              <th>탈퇴일</th>
              <th>상태</th>
              <th>월</th>
              <th>화</th>
              <th>수</th>
              <th>목</th>
              <th>금</th>
              <th>토</th>
              <th>일</th>
              <th>합계</th>
              <th>평균</th>
              <th>컷 달성</th>
              <th>방어덱</th>
              <th class="admin-only">관리</th>
            </tr>
          </thead>
          <tbody id="active-members-body"></tbody>
        </table>
      </div>
    </section>

    <!-- 주간 합계 표 -->
    <section id="week-summary" class="card">
      <div class="card-header">
        <h2>요일별 합계</h2>
      </div>
      <div class="table-wrapper">
        <table class="summary-table">
          <thead>
            <tr>
              <th>요일</th>
              <th>총합</th>
              <th>평균</th>
            </tr>
          </thead>
          <tbody id="week-summary-body"></tbody>
        </table>
      </div>
    </section>

    <!-- 이번 주 탈퇴자 -->
    <section id="left-members" class="card">
      <div class="card-header">
        <h2>이번 주 탈퇴자</h2>
      </div>
      <div class="table-wrapper">
        <table class="left-table">
          <thead>
            <tr>
              <th>닉네임</th>
              <th>탈퇴유형</th>
              <th>월</th>
              <th>화</th>
              <th>수</th>
              <th>목</th>
              <th>금</th>
              <th>토</th>
              <th>일</th>
              <th>탈퇴주차</th>
            </tr>
          </thead>
          <tbody id="left-members-body"></tbody>
        </table>
      </div>
    </section>

    <!-- 멤버 관리 (추가/수정/탈퇴/재가입) -->
    <section id="member-manage" class="card admin-only">
      <div class="card-header">
        <h2>멤버 관리</h2>
      </div>
      <div class="form-grid">
        <div class="form-row">
          <label>닉네임
            <input type="text" id="member-name-input" />
          </label>
          <label>직책
            <select id="member-role-input">
              <option value="길드원">길드원</option>
              <option value="부길드장">부길드장</option>
              <option value="길드장">길드장</option>
            </select>
          </label>
        </div>
        <div class="form-row">
          <label>가입일
            <input type="date" id="member-join-input" />
          </label>
          <label>상태
            <select id="member-status-input">
              <option value="active">활동중</option>
              <option value="left">탈퇴</option>
            </select>
          </label>
          <label>탈퇴주차(월요일 날짜)
            <input type="date" id="member-leave-week-input" />
          </label>
          <label>탈퇴유형
            <select id="member-leave-type-input">
              <option value="">(없음)</option>
              <option value="자진탈퇴">자진탈퇴</option>
              <option value="강퇴">강퇴</option>
            </select>
          </label>
        </div>
        <div class="form-row">
          <button type="button" id="member-add-btn">멤버 추가/갱신</button>
        </div>
      </div>
    </section>

    <!-- 멤버 아카이브 (전체 히스토리) -->
    <section id="member-archive" class="card">
      <div class="card-header">
        <h2>멤버 아카이브</h2>
      </div>
      <table>
        <thead>
          <tr>
            <th>번호</th>
            <th>닉네임</th>
            <th>직책</th>
            <th>가입일</th>
            <th>탈퇴일</th>
            <th>상태</th>
            <th>관리</th>
          </tr>
        </thead>
        <tbody id="member-archive-body"></tbody>
      </table>
    </section>
  </div>

  <!-- ✅ Firestore 모듈 사용을 위해 type="module" -->
  <script type="module" src="app.js"></script>
</body>
</html>
